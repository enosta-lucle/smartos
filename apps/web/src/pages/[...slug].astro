---
import { first } from "lodash-es";
import SectionAwards from "$/components/sections/awards.astro";
import SectionClients from "$/components/sections/clients.astro";
import SectionCTA from "$/components/sections/cta.astro";
import SectionCustomerSuccess from "$/components/sections/customer-success.astro";
import SectionFAQ from "$/components/sections/faq.astro";
import SectionFeatures from "$/components/sections/features.astro";
import SectionHero from "$/components/sections/hero.astro";
import SectionIntegrations from "$/components/sections/integrations.astro";
import SectionMetrics from "$/components/sections/metrics.astro";
import SectionResources from "$/components/sections/resources.astro";
import SectionSolutions from "$/components/sections/solutions.astro";

import MainLayout from "$/layouts/main-layout.astro";
import type { PageResponse } from "$/types/strapi.type";
import { api } from "$/utils/client.util";

export function getStaticPaths() {
  return [{ params: { slug: "/" } }, { params: { slug: "/living" } }];
}

const slug = Astro.params.slug || "/";

const page = await api<PageResponse>("/pages", {
  filters: { slug },
});

const { sections, seo } = first(page?.data ?? []) ?? {};

const SECTIONS: Record<string, any> = {
  hero: SectionHero,
  solutions: SectionSolutions,
  metrics: SectionMetrics,
  clients: SectionClients,
  features: SectionFeatures,
  integrations: SectionIntegrations,
  "customer-success": SectionCustomerSuccess,
  resource: SectionResources,
  faq: SectionFAQ,
  cta: SectionCTA,
  awards: SectionAwards,
};

const STYLES: Record<string, Record<string, string[]>> = {
  "/": {
    solutions: ["mt-12"],
    metrics: ["mt-10 md:mt-20"],
    clients: ["mt-16", "md:mt-25"],
    features: ["mt-16", "md:mt-25"],
    faq: ["mt-8", "md:mt-23"],
    integrations: ["mt-16", "md:mt-25"],
    "customer-success": ["mt-10", "md:mt-25"],
    resource: ["mt-12", "md:mt-25"],
    cta: ["mt-12", "md:mt-25"],
    awards: ["mt-12", "md:mt-25"],
  },
  "/living": {
    solutions: ["mt-10"],
  },
};
const a = first(page?.data ?? []) ?? {};
---

<script define:vars={{ sections, a }}>
  console.log(sections);
  console.log(a);
</script>

<MainLayout seo={seo}>
  {
    sections?.map((section) => {
      const key = section.__component.replace("section.", "");

      const Section = SECTIONS[key];
      const className = STYLES[slug]?.[key];

      if (!Section) return null;

      return <Section {...section} class:list={className} />;
    })
  }

  <!-- <SectionMetrics class:list={["mt-10 md:mt-20"]} /> -->
  <!-- <SectionClients class:list={["mt-16", "md:mt-25"]} /> -->
  <!-- <SectionFeatures class:list={["mt-16", "md:mt-25"]} /> -->
  <!-- <SectionIntegrations class:list={["mt-16", "md:mt-25"]} /> -->
  <!-- <SectionCustomerSuccess class:list={["mt-10", "md:mt-25"]} /> -->
  <!-- <SectionResources class:list={["mt-12", "md:mt-25"]} /> -->
  <!-- <SectionFaq class:list={["mt-8", "md:mt-23"]} /> -->
  <!-- <SectionCTA class:list={["mt-12", "md:mt-25"]} /> -->
  <!-- <SectionAwards class:list={["mt-12", "md:mt-25"]} /> -->
</MainLayout>
