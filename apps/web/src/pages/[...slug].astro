---
import { first } from "lodash-es";
import SectionAwards from "$/components/sections/awards.astro";
import SectionClients from "$/components/sections/clients.astro";
import SectionContact from "$/components/sections/contact.astro";
import SectionCustomerSuccess from "$/components/sections/customer-success.astro";
import SectionFaq from "$/components/sections/faq.astro";
import SectionFeatures from "$/components/sections/features.astro";
import SectionHero from "$/components/sections/hero.astro";
import SectionIntegrations from "$/components/sections/integrations.astro";
import SectionMetrics from "$/components/sections/metrics.astro";
import SectionResources from "$/components/sections/resources.astro";
import SectionSolutions from "$/components/sections/solutions.astro";

import MainLayout from "$/layouts/main-layout.astro";
import type { PageResponse } from "$/types/strapi.type";
import { api } from "$/utils/client.util";

export function getStaticPaths() {
  return [{ params: { slug: "/" } }, { params: { slug: "/living" } }];
}

const slug = Astro.params.slug || "/";
console.log({ slug });

const page = await api<PageResponse>("/pages", {
  filters: { slug },
});

const { sections } = first(page?.data ?? []) ?? {};

const SECTIONS: Record<string, any> = {
  hero: SectionHero,
  solutions: SectionSolutions,
  metrics: SectionMetrics,
  clients: SectionClients,
  features: SectionFeatures,
  integrations: SectionIntegrations,
  customerSuccess: SectionCustomerSuccess,
  resources: SectionResources,
  faq: SectionFaq,
  contact: SectionContact,
  awards: SectionAwards,
};

const STYLES: Record<string, Record<string, string[]>> = {
  "/": {
    solutions: ["mt-12"],
  },
};
---

<script define:vars={{ sections }}>
  console.log(sections);
</script>

<MainLayout>
  {
    sections?.map((section) => {
      const key = section.__component.replace("section.", "");

      const Section = SECTIONS[key];
      const className = STYLES[slug]?.[key];

      if (!Section) return null;

      return <Section {...section} class:list={className} />;
    })
  }

  <SectionMetrics class:list={["mt-10 md:mt-20"]} />
  <SectionClients class:list={["mt-16", "md:mt-25"]} />
  <SectionFeatures class:list={["mt-16", "md:mt-25"]} />
  <SectionIntegrations class:list={["mt-16", "md:mt-25"]} />
  <SectionCustomerSuccess class:list={["mt-10", "md:mt-25"]} />
  <SectionResources class:list={["mt-12", "md:mt-25"]} />
  <SectionFaq class:list={["mt-8", "md:mt-23"]} />
  <SectionContact class:list={["mt-12", "md:mt-25"]} />
  <SectionAwards class:list={["mt-12", "md:mt-25"]} />
</MainLayout>
